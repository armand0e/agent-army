# EXAMPLE: Simple `open-codex-flow` - Uppercase Fruits

This document describes a simple, runnable (conceptually) example of an `open-codex-flow` orchestrated by the `OpenHands` Orchestrator Agent. It tests the agent's ability to decompose a task, manage a sequence of operations, and handle file I/O within its workspace.

## 1. User Task

The user provides the following high-level task to the `OpenHands` Orchestrator Agent (via the OpenHands UI or CLI):

"I have a file named `input.txt` in the root of the workspace. It contains a list of fruits, one per line. Please create a new file named `output.txt` in the root of the workspace, containing the same fruits but all in uppercase."

## 2. Prerequisites for the Test

1.  The `scripts/launch_openhands_orchestrator.sh` script has been run, and the `OpenHands` instance is accessible.
2.  The `OpenHands` agent is configured with the user's LLM (via the settings file generated by the script) and is using the `custom_instructions` for orchestration.
3.  A file named `input.txt` is manually created by the user in the `OpenHands` workspace root (`/workspace/`) before giving the task. Example content for `/workspace/input.txt`:
    ```
    apple
    banana
    cherry
    date
    ```
4.  The `open_codex_lib` is conceptually available to the Orchestrator Agent. For this example, the Orchestrator will use its own LLM and file system tools (available in OpenHands) to simulate the actions of `open_codex_lib` operations where direct library calls are not yet implemented.

## 3. Expected Orchestrator Agent Behavior

The `OpenHands` Orchestrator Agent, guided by its `custom_instructions`, should perform the following steps:

### Step A: Task Understanding and Planning (Internal LLM Call)

The Orchestrator Agent receives the user's task. It makes an internal call to its configured LLM (e.g., `gpt-3.5-turbo` aliasing `devstral-small`) with a prompt similar to its "Task Decomposition Prompt" strategy.

**Expected LLM Output (The Plan):** A JSON structure like this:
```json
[
  {
    "id": "step1_read_input",
    "operation": "read_file",
    "params": {"file_path": "/workspace/input.txt"},
    "description": "Read the content of input.txt."
  },
  {
    "id": "step2_transform_content",
    "operation": "transform_text_uppercase",
    "params": {"content_from_step": "step1_read_input"},
    "description": "Convert the content read from input.txt to uppercase."
  },
  {
    "id": "step3_write_output",
    "operation": "write_file",
    "params": {"file_path": "/workspace/output.txt", "content_from_step": "step2_transform_content"},
    "description": "Write the uppercased content to output.txt."
  },
  {
    "id": "step4_summarize",
    "operation": "generate_summary",
    "params": {"message": "Successfully uppercased fruits from input.txt and saved to output.txt."},
    "description": "Report completion to the user."
  }
]
```
*(Note: The `transform_text_uppercase` operation might be a specific instruction to a generic `process_text_with_llm` operation in a real `open_codex_lib`, or the Orchestrator might handle this transformation directly using an LLM call if `open_codex_lib` doesn't have this specific utility).*

### Step B: User Confirmation of Plan (Optional but Recommended)

The Orchestrator Agent should present this plan to the user for confirmation:
"Okay, I understand you want to uppercase the fruits in `input.txt` and save to `output.txt`. Here's my plan:
1. Read `input.txt`.
2. Convert its content to uppercase.
3. Write the result to `output.txt`.
4. Summarize the task.
Shall I proceed?"

User responds: "Yes"

### Step C: Execution of the Flow

The Orchestrator Agent creates a task directory, e.g., `/workspace/orchestrator_tasks/uppercase_fruits_task_001/`.

1.  **Execute `step1_read_input`:**
    *   **Action:** The Orchestrator uses `OpenHands` internal tools (or conceptual `open_codex_lib.execute_operation` for `read_file`) to read `/workspace/input.txt`.
    *   **Result:** The content ("apple
banana
cherry
date") is stored internally by the Orchestrator, perhaps in a state variable or a temporary file within its task directory (e.g., `/workspace/orchestrator_tasks/uppercase_fruits_task_001/step1_output.txt`).

2.  **Execute `step2_transform_content`:**
    *   **Action:** The Orchestrator takes the content from step 1. It makes an LLM call (simulating an `open_codex_lib` operation or directly) with a prompt like: "Convert the following text to uppercase: [content from step 1]".
    *   **LLM Response:** "APPLE
BANANA
CHERRY
DATE"
    *   **Result:** This uppercased string is stored by the Orchestrator (e.g., in `/workspace/orchestrator_tasks/uppercase_fruits_task_001/step2_output.txt`).

3.  **Execute `step3_write_output`:**
    *   **Action:** The Orchestrator uses `OpenHands` internal tools (or conceptual `open_codex_lib.execute_operation` for `write_file`) to write the uppercased string from step 2 into the file `/workspace/output.txt`.
    *   **Result:** The file `/workspace/output.txt` is created/overwritten with the uppercased content.

4.  **Execute `step4_summarize`:**
    *   **Action:** The Orchestrator prepares the summary message.
    *   **Result:** Message "Successfully uppercased fruits from input.txt and saved to output.txt." is ready.

### Step D: Final Report to User

The Orchestrator Agent presents the final summary to the user:
"Task complete! Successfully uppercased fruits from `input.txt` and saved to `output.txt`. You can find the result in `/workspace/output.txt`."

## 4. Verification

*   The user (or an automated check if this were a test script) would verify that `/workspace/output.txt` exists and contains:
    ```
    APPLE
    BANANA
    CHERRY
    DATE
    ```

## 5. Simulating `open_codex_lib`

Since `open_codex_lib` is not yet implemented, the `OpenHands` Orchestrator Agent, when its `custom_instructions` mention calling `open_codex_lib.execute_operation(...)`, will have to achieve the sub-step's goal using:
*   Its own LLM calls for text processing or simple code generation/modification tasks.
*   `OpenHands`'s built-in file system tools (read, write, list files).
*   `OpenHands`'s built-in command execution for simple shell commands if needed (though less ideal for complex logic).

The "instructions" that would have gone into an `open_codex_instructions.md` file for `open_codex_lib` will instead be used by the Orchestrator Agent to formulate its own LLM prompts or to guide its use of `OpenHands` tools directly for this example. The key is testing the Orchestrator's planning and sequential execution logic.
